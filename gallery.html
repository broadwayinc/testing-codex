<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Photo Gallery</title>
    <script src="https://cdn.jsdelivr.net/npm/skapi-js@latest/dist/skapi.js"></script>
    <script>
        const skapi = new Skapi('ap22oqBfHOrr8X4OeFEc', 'f8e16604-69e4-451c-9d90-4410f801c006');
        async function loadGallery(){
            const profile = await skapi.getProfile();
            if(!profile){
                location.href = 'index.html';
                return;
            }
            const userId = profile.user_id;
            const res = await skapi.getRecords({ table: 'photos' });
            const gallery = document.getElementById('gallery');
            res.list.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'gallery-item';
                const img = document.createElement('img');
                img.src = rec.bin.picture[0].url;
                img.alt = rec.data?.description || '';
                const p = document.createElement('p');
                p.textContent = rec.data?.description || '';
                div.appendChild(img);
                div.appendChild(p);
                if(rec.user_id === userId){
                    const del = document.createElement('button');
                    del.textContent = 'Delete';
                    del.onclick = () => {
                        skapi.deleteRecords({ record_id: rec.record_id }).then(() => location.reload());
                    };
                    div.appendChild(del);
                }
                gallery.appendChild(div);
            });
        }
        window.addEventListener('DOMContentLoaded', loadGallery);
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Photo Gallery</h1>
    <div id="gallery"></div>
    <a href="index.html">Home</a>
</body>
</html>
